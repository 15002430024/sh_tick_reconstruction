# ä¸Šäº¤æ‰€é€ç¬”æ•°æ®æ‹†è§£å·¥ç¨‹ - è½åœ°è®¡åˆ’

> **å¯¹åº”éœ€æ±‚æ–‡æ¡£**: SH_Tick_Data_Reconstruction_Spec v1.8  
> **åˆ›å»ºæ—¥æœŸ**: 2026-01-26  
> **è¾“å‡ºäº§ç‰©**: `{date}_sh_order_data.parquet` + `{date}_sh_trade_data.parquet`

---

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

### æ ¸å¿ƒç›®æ ‡

å°†ä¸Šäº¤æ‰€ `auction_tick_merged_data` æ··åˆæ•°æ®æµæ‹†è§£è¿˜åŸä¸ºä¸¤å¼ ç‹¬ç«‹è¡¨ï¼š

| é€»è¾‘è¡¨å | è½ç›˜æ–‡ä»¶å | å¯¹æ ‡ |
|----------|-----------|------|
| `derived_sh_orders` | `{date}_sh_order_data.parquet` | `sz_order_data` |
| `derived_sh_trades` | `{date}_sh_trade_data.parquet` | `sz_trade_data` |

### å…³é”®ä¸šåŠ¡è§„åˆ™

1. **ä¸Šäº¤æ‰€ç‰¹æ®Šè§„åˆ™**: å³æ—¶å…¨éƒ¨æˆäº¤çš„å§”æ‰˜æ²¡æœ‰ Type='A' è®°å½•
2. **æ•°æ®å‘é€é¡ºåº**: å…ˆå‘é€æˆäº¤(T)ï¼Œå†å‘é€å‰©ä½™æŒ‚å•(A)
3. **æ¯å•èšåˆ**: åŒä¸€ OrderNO çš„å¤šæ¡æˆäº¤å¿…é¡»èšåˆä¸ºä¸€æ¡å§”æ‰˜
4. **IsAggressive åˆ¤å®š**: åªçœ‹"å‡ºç”Ÿæ–¹å¼"ï¼ˆé¦–æ¬¡å‡ºç°æ˜¯Tè¿˜æ˜¯Aï¼‰
5. **åªè¿˜åŸä¸»åŠ¨æ–¹**: è¢«åŠ¨æ–¹å·²æœ‰ Type='A' è®°å½•ï¼Œä¸é‡å¤è¿˜åŸ

### è¾“å‡ºæ–‡ä»¶è§„æ ¼

```
/raw_data/
â”œâ”€â”€ {date}_sh_order_data.parquet    # ä¸Šäº¤æ‰€å§”æ‰˜ï¼ˆæœ¬é¡¹ç›®äº§å‡ºï¼‰
â”œâ”€â”€ {date}_sh_trade_data.parquet    # ä¸Šäº¤æ‰€æˆäº¤ï¼ˆæœ¬é¡¹ç›®äº§å‡ºï¼‰
â”œâ”€â”€ {date}_sz_order_data.parquet    # æ·±äº¤æ‰€å§”æ‰˜ï¼ˆå·²æœ‰ï¼‰
â””â”€â”€ {date}_sz_trade_data.parquet    # æ·±äº¤æ‰€æˆäº¤ï¼ˆå·²æœ‰ï¼‰
```

---

## ğŸ“Š è¾“å‡º Schema å®šä¹‰

### sh_order_dataï¼ˆè¿˜åŸåçš„å§”æ‰˜è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | æ¥æºé€»è¾‘ |
|------|------|------|----------|
| `SecurityID` | varchar | **è¯åˆ¸ä»£ç ** | â­ åŸå­—æ®µï¼ˆå…¨å¸‚åœºè¾“å‡ºå¿…éœ€ï¼‰ |
| `BizIndex` | int | é¦–æ¬¡å‡ºç°çš„é€ç¬”åºå· | ç”¨äºæ’åºå’Œå®¡è®¡ |
| `TickTime` | int | å§”æ‰˜æ—¶é—´ (HHMMSSmmm) | è¯¥ OrdID é¦–æ¬¡å‡ºç°çš„æ—¶é—´ |
| `OrdID` | int | å§”æ‰˜å•å· | `BuyOrderNO` æˆ– `SellOrderNO` |
| `OrdType` | enum | `New` / `Cancel` | New=è¿˜åŸå§”æ‰˜; Cancel=æ’¤å• |
| `Side` | enum | `B` / `S` | ä¹°å–æ–¹å‘ |
| `Price` | decimal | å§”æ‰˜ä»·æ ¼ | Açš„Price / Tçš„æˆäº¤ä»· / ç¼“å­˜å›æº¯ |
| `Qty` | int | **åŸå§‹å§”æ‰˜é‡** | èšåˆè®¡ç®—: `âˆ‘T.Qty + A.Qty` |
| `IsAggressive` | nullable bool | å…¥åœºè¿›æ”»æ€§æ ‡è¯† | True=Taker, False=Maker, None=æ’¤å• |

### sh_trade_dataï¼ˆæ ‡å‡†åŒ–æˆäº¤è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | æ¥æº |
|------|------|------|------|
| `SecurityID` | varchar | è¯åˆ¸ä»£ç  | åŸå­—æ®µ |
| `BizIndex` | int | é€ç¬”åºå· | åŸå­—æ®µ |
| `TickTime` | int | æˆäº¤æ—¶é—´ | åŸå­—æ®µ |
| `BidOrdID` | int | ä¹°å•å· | åŸ `BuyOrderNO` |
| `AskOrdID` | int | å–å•å· | åŸ `SellOrderNO` |
| `Price` | decimal | æˆäº¤ä»· | åŸ `Price` |
| `Qty` | int | æˆäº¤é‡ | åŸ `Qty` |
| `TradeMoney` | decimal | æˆäº¤é‡‘é¢ | åŸ `TradeMoney` |
| `ActiveSide` | int | ç»Ÿä¸€ä¸»åŠ¨æ–¹å‘ | 1=ä¸»åŠ¨ä¹°, 2=ä¸»åŠ¨å–, 0=é›†åˆç«ä»· |

---

## ğŸ—“ï¸ åˆ†é˜¶æ®µè½åœ°è®¡åˆ’

### Phase 1: æ•°æ®ç»“æ„ä¸åŸºç¡€æ¡†æ¶ (Day 1-2)

| ä»»åŠ¡ID | ä»»åŠ¡ | è¯´æ˜ | éªŒæ”¶æ ‡å‡† |
|--------|------|------|----------|
| 1.1 | å®šä¹‰ OrderContext æ•°æ®ç±» | ç¼“å­˜å•ä¸ªè®¢å•çš„ç´¯è®¡ä¿¡æ¯ | åŒ…å«æ‰€æœ‰å¿…è¦å­—æ®µ |
| 1.2 | å®šä¹‰è¾“å‡º Schema | sh_order_data / sh_trade_data | ä¸æœ¬æ–‡æ¡£å®Œå…¨ä¸€è‡´ |
| 1.3 | å®ç°æ—¶é—´è¿‡æ»¤å‡½æ•° | `is_continuous_trading_time()` | æ­£ç¡®è¿‡æ»¤é›†åˆç«ä»· |
| 1.4 | æ­å»ºä¸»å‡½æ•°æ¡†æ¶ | `reconstruct_sh_tick_data()` | ç©ºå£³å¯è¿è¡Œ |

**Phase 1 äº§å‡ºæ¸…å•**:
- [ ] `OrderContext` dataclass ä»£ç ï¼ˆå« `has_resting` å­—æ®µï¼‰
- [ ] è¾“å‡º Schema å®šä¹‰ï¼ˆPolars/PyArrowï¼‰
- [ ] `is_continuous_trading_time()` å‡½æ•°ï¼ˆä¸Šäº¤æ‰€ï¼š13:00-15:00ï¼‰
- [ ] ä¸»å‡½æ•°éª¨æ¶

---

### Phase 2: æ ¸å¿ƒå¤„ç†é€»è¾‘ (Day 3-5)

| ä»»åŠ¡ID | ä»»åŠ¡ | è¯´æ˜ | éªŒæ”¶æ ‡å‡† |
|--------|------|------|----------|
| 2.1 | å®ç° `process_trade()` | å¤„ç† Type='T' æˆäº¤è®°å½• | æ­£ç¡®è¿˜åŸä¸»åŠ¨æ–¹ã€ç´¯åŠ åˆ°ç¼“å­˜ |
| 2.2 | å®ç° `process_add_order()` | å¤„ç† Type='A' æŒ‚å•è®°å½• | æ­£ç¡®åˆ¤æ–­ IsAggressive |
| 2.3 | å®ç° `process_delete_order()` | å¤„ç† Type='D' æ’¤å•è®°å½• | ä»·æ ¼å›æº¯é€»è¾‘æ­£ç¡® |
| 2.4 | å®ç° `settle_orders()` | æ‰¹æ¬¡ç»“ç®—ï¼Œè¾“å‡ºèšåˆå§”æ‰˜ | Qty = trade_qty + resting_qty |

**Phase 2 å…³é”®é€»è¾‘æ˜ å°„**:

```
æµç¨‹å›¾ â†’ ä»£ç å‡½æ•°æ˜ å°„:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é€ç¬”æˆäº¤ä¾§ä¿®æ­£ â†’ process_trade()                                 â”‚
â”‚  â”œâ”€ æ˜¯å¦ä¸»åŠ¨ä¹°å…¥ï¼Ÿ â†’ TickBSFlag='B' åˆ™ active_order_no=BuyOrderNOâ”‚
â”‚  â”œâ”€ è®¢å•å·åœ¨ç¼“å­˜ï¼Ÿ                                               â”‚
â”‚  â”‚   â”œâ”€ æ˜¯ â†’ order_map[no].add_trade_qty(qty)                  â”‚
â”‚  â”‚   â””â”€ å¦ â†’ æ–°å»º OrderContext(is_aggressive=True)             â”‚
â”‚  â””â”€ è¾“å‡ºåˆ° trade_listï¼ˆå« SecurityIDï¼‰                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é€ç¬”å§”æ‰˜ä¾§ä¿®æ­£ â†’ process_add_order()                             â”‚
â”‚  â”œâ”€ è®¢å•å·åœ¨ç¼“å­˜ï¼Ÿï¼ˆå³å·²æœ‰æˆäº¤ï¼‰                                  â”‚
â”‚  â”‚   â”œâ”€ æ˜¯ â†’ ä¿æŒ is_aggressive=Trueï¼Œç´¯åŠ  resting_qty          â”‚
â”‚  â”‚   â”‚      è®¾ç½® has_resting=True                              â”‚
â”‚  â”‚   â””â”€ å¦ â†’ æ–°å»º OrderContext(is_aggressive=False)            â”‚
â”‚  â”‚          è®¾ç½® has_resting=True                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Phase 2 äº§å‡ºæ¸…å•**:
- [ ] `process_trade()` å‡½æ•° + å•å…ƒæµ‹è¯•
- [ ] `process_add_order()` å‡½æ•° + å•å…ƒæµ‹è¯•
- [ ] `process_delete_order()` å‡½æ•° + å•å…ƒæµ‹è¯•
- [ ] `settle_orders()` å‡½æ•° + å•å…ƒæµ‹è¯•

---

### Phase 3: æ’åºä¸æ‰¹é‡å¤„ç† (Day 6-7)

| ä»»åŠ¡ID | ä»»åŠ¡ | è¯´æ˜ | éªŒæ”¶æ ‡å‡† |
|--------|------|------|----------|
| 3.1 | å®ç°åŒé‡æ’åº | `(TickTime, BizIndex)` | åŒæ¯«ç§’å†…é¡ºåºæ­£ç¡® |
| 3.2 | å®ç°æ‰¹é‡å¤„ç†å…¥å£ | `process_daily_data()` | æŒ‰ SecurityID åˆ†ç»„ |
| 3.3 | å…¨å¸‚åœºæ’åºè¾“å‡º | `(SecurityID, TickTime, BizIndex)` | Parquet ç‰©ç†æ’åº |
| 3.4 | BizIndex è¿ç»­æ€§æ£€æŸ¥ | è·³å·æ£€æµ‹å‘Šè­¦ | è®°å½•æ—¥å¿— |

**ğŸ”´ Phase 3 å…³é”®çº¦æŸï¼ˆé“å¾‹ï¼‰**:

| çº¦æŸ | é”™è¯¯åšæ³• | æ­£ç¡®åšæ³• |
|------|----------|----------|
| æ’åºé”® | åªç”¨ `TickTime` | å¿…é¡»ç”¨ `(TickTime, BizIndex)` |
| æ’¤å• BizIndex | ç”¨åŸå§”æ‰˜çš„ BizIndex | ç”¨æ’¤å•è®°å½•è‡ªèº«çš„ BizIndex |
| è¾“å‡ºæ’åº | ä¸æ’åºç›´æ¥å†™ | æŒ‰ `(SecurityID, TickTime, BizIndex)` æ’åºåå†™ |
| æ–‡ä»¶å‘½å | ä»»æ„å‘½å | å¿…é¡»ä¸º `{date}_sh_order_data.parquet` |

**Phase 3 äº§å‡ºæ¸…å•**:
- [ ] `reconstruct_sh_tick_data()` å®Œæ•´å®ç°
- [ ] `process_daily_data()` æ‰¹é‡å¤„ç†å‡½æ•°
- [ ] `check_bizindex_continuity()` æ£€æŸ¥å‡½æ•°
- [ ] Parquet å†™å…¥é€»è¾‘ï¼ˆå«æ’åºã€nullable boolï¼‰

---

### Phase 4: æµ‹è¯•ä¸éªŒè¯ (Day 8-10)

| ä»»åŠ¡ID | ä»»åŠ¡ | è¯´æ˜ | éªŒæ”¶æ ‡å‡† |
|--------|------|------|----------|
| 4.1 | å•å…ƒæµ‹è¯• | 7ä¸ªæ ¸å¿ƒåœºæ™¯ | å…¨éƒ¨é€šè¿‡ |
| 4.2 | é€šé“æ•°å­¦å…³ç³»æ ¡éªŒ | Ch7=Ch9+Ch11 ç­‰ | æ•°å€¼ç›¸ç­‰ |
| 4.3 | çœŸå®æ•°æ®éªŒè¯ | æŠ½æ · 10 åªè‚¡ç¥¨ | æ— å¼‚å¸¸ |
| 4.4 | è¾¹ç•Œæƒ…å†µå¤„ç† | Price=0, OrderNO=0 | æ­£ç¡®å…œåº• |

**7ä¸ªæ ¸å¿ƒæµ‹è¯•åœºæ™¯**:

| åœºæ™¯ | è¾“å…¥ç‰¹å¾ | æœŸæœ›ç»“æœ |
|------|----------|----------|
| 1. å³æ—¶å…¨éƒ¨æˆäº¤ | åªæœ‰Tï¼Œæ— A | `IsAggressive=True`, `Qty=T.Qty` |
| 2. éƒ¨åˆ†æˆäº¤è½¬æŒ‚å• | å…ˆTåA | `IsAggressive=True`, `Qty=T.Qty+A.Qty` |
| 3. çº¯æŒ‚å• | åªæœ‰A | `IsAggressive=False`, `Qty=A.Qty` |
| 4. å¤šæ¬¡éƒ¨åˆ†æˆäº¤ | å¤šä¸ªT+1ä¸ªA | `Qty=âˆ‘T.Qty+A.Qty` |
| 5. æ’¤å•ä»·æ ¼å›æº¯ | AåDï¼ŒDçš„Price=0 | æ’¤å•Price=Açš„Price, `IsAggressive=None` |
| 6. è¢«åŠ¨å•åç»­æˆäº¤ | é¦–æ¬¡Aï¼Œåç»­Tæˆäº¤ | `IsAggressive=False` |
| 7. é€šé“æ•°å­¦å…³ç³» | æ··åˆæ•°æ® | `Ch7=Ch9+Ch11`, `Ch8=Ch10+Ch12` |

**Phase 4 äº§å‡ºæ¸…å•**:
- [x] pytest æµ‹è¯•å¥—ä»¶ï¼ˆ7å¤§åœºæ™¯ + è¾¹ç•Œæƒ…å†µï¼‰
- [x] é€šé“æ•°å­¦éªŒè¯ï¼ˆCh7=Ch9+Ch11 æµ‹è¯•ï¼‰
- [ ] çœŸå®æ•°æ®æŠ½æ ·éªŒè¯æŠ¥å‘Š
- [x] è¾¹ç•Œæƒ…å†µå¤„ç†ï¼ˆç©ºè¾“å…¥ã€Price=0ã€OrderNO=0ï¼‰

---

### Phase 5: ä¸å›¾åƒæ„å»ºå¯¹æ¥ (Day 11-12)

| ä»»åŠ¡ID | ä»»åŠ¡ | è¯´æ˜ | éªŒæ”¶æ ‡å‡† |
|--------|------|------|----------|
| 5.1 | æ¥å…¥ trades é€šé“ | Ch0-6 | æ•°æ®æ­£ç¡® |
| 5.2 | æ¥å…¥ orders é€šé“ | Ch7-14 | IsAggressive åˆ†æµæ­£ç¡® |
| 5.3 | æ²ªæ·±ç»Ÿä¸€åŒ–éªŒè¯ | ActiveSide æ ¼å¼ä¸€è‡´ | ä¸‹æ¸¸æ— éœ€åˆ†æ”¯ä»£ç  |

**é€šé“æ˜ å°„è¡¨**:

| é€šé“ | æ•°æ®æº | ç­›é€‰æ¡ä»¶ |
|------|--------|----------|
| 0-2 | sh_trade_data | ActiveSide åˆ†æµ |
| 3-6 | sh_trade_data | æ¯å•é‡‘é¢å¤§å° |
| 7-8 | sh_order_data | `OrdType='New'` + Side |
| 9-10 | sh_order_data | `IsAggressive=True` + Side |
| 11-12 | sh_order_data | `IsAggressive=False` + Side |
| 13-14 | sh_order_data | `OrdType='Cancel'` + Side |

**Phase 5 äº§å‡ºæ¸…å•**:
- [ ] å›¾åƒæ„å»ºæ¥å…¥ä»£ç 
- [ ] æ²ªæ·±æ•°æ®ä¸€è‡´æ€§éªŒè¯æŠ¥å‘Š
- [ ] ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•

---

## âœ… æ¯æ—¥æ£€æŸ¥æ¸…å•

### å¼€å‘è¿‡ç¨‹æ£€æŸ¥é¡¹

- [ ] **æ’åºæ˜¯å¦æ­£ç¡®ï¼Ÿ** å¿…é¡»ç”¨ `(TickTime, BizIndex)` åŒé‡æ’åº
- [ ] **IsAggressive åˆ¤å®šæ˜¯å¦æ­£ç¡®ï¼Ÿ** åªçœ‹é¦–æ¬¡å‡ºç°çš„ Type
- [ ] **æ’¤å• IsAggressive æ˜¯å¦ä¸º Noneï¼Ÿ** ä¸æ˜¯ False
- [ ] **æ˜¯å¦åªè¿˜åŸä¸»åŠ¨æ–¹ï¼Ÿ** è¢«åŠ¨æ–¹å·²æœ‰ Type='A' è®°å½•
- [ ] **Parquet IsAggressive ç±»å‹æ˜¯å¦ä¸º nullable boolï¼Ÿ**
- [ ] **è¾“å‡ºæ˜¯å¦åŒ…å« SecurityID å­—æ®µï¼Ÿ** å…¨å¸‚åœºè¾“å‡ºå¿…éœ€
- [ ] **æ—¶é—´è¿‡æ»¤æ˜¯å¦æ­£ç¡®ï¼Ÿ** ä¸Šäº¤æ‰€ä¸‹åˆæ˜¯ 13:00-15:00ï¼ˆæ— æ”¶ç›˜é›†åˆç«ä»·ï¼‰

### å¸¸è§é”™è¯¯æé†’

| é”™è¯¯ | åæœ | æ­£ç¡®åšæ³• |
|------|------|----------|
| æ’åºåªç”¨ TickTime | åŒæ¯«ç§’å†…äº‹ä»¶é¡ºåºéšæœºåŒ– | ç”¨ `(TickTime, BizIndex)` |
| ä» T è®°å½•è¿˜åŸè¢«åŠ¨æ–¹ | é€šé“11/12åƒç´ å€¼è™šé«˜ä¸€å€ | åªè¿˜åŸä¸»åŠ¨æ–¹ |
| æ’¤å• IsAggressive=False | ä¸é˜²å®ˆå•æ··æ·† | å¡« None |
| è¢«åŠ¨å•åç»­æˆäº¤æ ‡ä¸º True | Taker/Maker åˆ†ç±»é”™è¯¯ | åªçœ‹é¦–æ¬¡å‡ºç°ç±»å‹ |
| ä½¿ç”¨ T æ—¥æ•°æ®è®¡ç®—é˜ˆå€¼ | å¼•å…¥æœªæ¥å‡½æ•° | åªç”¨ T-20 è‡³ T-1 æ—¥æ•°æ® |
| è¾“å‡ºç¼ºå°‘ SecurityID | å…¨å¸‚åœºæ’åºå¤±è´¥ | å¿…é¡»åŒ…å« SecurityID å­—æ®µ |
| ä¸Šäº¤æ‰€ä¸‹åˆè¿‡æ»¤åˆ° 14:57 | ä¸¢å¤± 14:57-15:00 æ•°æ® | ä¸Šäº¤æ‰€åº”è¿‡æ»¤åˆ° 15:00 |

---

## ğŸ”´ æ²ªæ·±å·®å¼‚é€ŸæŸ¥è¡¨

| å·®å¼‚ç‚¹ | ä¸Šäº¤æ‰€ | æ·±äº¤æ‰€ |
|--------|--------|--------|
| ä¸‹åˆè¿ç»­ç«ä»·ç»“æŸ | **15:00** | 14:57 |
| æ”¶ç›˜é›†åˆç«ä»· | **æ— ** | 14:57-15:00 |
| ä¸»åŠ¨æ–¹å‘åˆ¤å®š | `TickBSFlag` | `BidApplSeqNum > OfferApplSeqNum` |
| å§”æ‰˜æ•°æ®æ¥æº | ä»æ··åˆæµè¿˜åŸ | ç‹¬ç«‹çš„ `sz_order_data` |

---

## ğŸ“ æ–‡ä»¶äº¤ä»˜æ¸…å•

### æœ€ç»ˆäº¤ä»˜ç‰©

```
sh_tick_reconstruction/
â”œâ”€â”€ __init__.py                # æ¨¡å—å…¥å£ï¼Œå¯¼å‡ºå…¬å…±æ¥å£
â”œâ”€â”€ models.py                  # OrderContext æ•°æ®ç±»ï¼ˆå« has_restingï¼‰
â”œâ”€â”€ reconstructor.py           # æ ¸å¿ƒå¤„ç†å‡½æ•°ï¼ˆprocess_trade/add_order/delete_order/settle_ordersï¼‰
â”œâ”€â”€ schema.py                  # è¾“å‡º Schema å®šä¹‰ï¼ˆPyArrow/Polarsï¼‰
â”œâ”€â”€ time_filter.py             # æ—¶é—´è¿‡æ»¤ï¼ˆä¸Šäº¤æ‰€ï¼š09:30-11:30, 13:00-15:00ï¼‰
â”œâ”€â”€ batch.py                   # æ‰¹é‡å¤„ç†å…¥å£ï¼ˆprocess_daily_dataï¼‰
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_scenarios.py      # 7å¤§åœºæ™¯æµ‹è¯•
â”‚   â”œâ”€â”€ test_batch.py          # æ‰¹é‡å¤„ç†æµ‹è¯•
â”‚   â”œâ”€â”€ test_integration.py    # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ test_settle_orders.py  # settle_orders ä¸“é¡¹æµ‹è¯•
â””â”€â”€ scripts/
    â”œâ”€â”€ run_daily.py           # æ¯æ—¥æ‰¹é‡å¤„ç†è„šæœ¬
    â””â”€â”€ validate_output.py     # è¾“å‡ºéªŒè¯è„šæœ¬
```

### è¾“å‡ºæ•°æ®

```
/raw_data/
â”œâ”€â”€ {date}_sh_order_data.parquet   # å¯¹åº”é€»è¾‘è¡¨ derived_sh_orders
â””â”€â”€ {date}_sh_trade_data.parquet   # å¯¹åº”é€»è¾‘è¡¨ derived_sh_trades
```

---

## ğŸ“š é…å¥—æ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜ |
|------|------|
| `SH_Tick_Data_Reconstruction_Spec_v1.8.md` | éœ€æ±‚æ–‡æ¡£ï¼ˆä¸šåŠ¡è§„åˆ™ï¼‰ |
| `SH_Tick_Reconstruction_Prompts.md` | æç¤ºè¯æ‰‹å†Œï¼ˆAI åä½œï¼‰ |
| `L2_data_dictionary.md` | æ•°æ®å­—å…¸ï¼ˆå­—æ®µå®šä¹‰ï¼‰ |

---

*æ–‡æ¡£ç»“æŸ*
